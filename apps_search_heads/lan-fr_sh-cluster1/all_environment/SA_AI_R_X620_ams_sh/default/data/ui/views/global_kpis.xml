<form hideSplunkBar="true" hideEdit="true" stylesheet="ai-x620-ams.css">
  <label>2.2 - AMS ABSENCES KPIs</label>
  <search id="base_search">
    <query>|`ams_absence($select_natco$)`</query>
    <earliest>$earliest$</earliest>
    <latest>$latest$</latest>
  </search>
  <search id="base_search_view_table">
    <query>|`Absence_report`</query>
    <earliest>-24h@h</earliest>
    <latest>now</latest>
    <sampleRatio>1</sampleRatio>
  </search>
  <search id="base_search_cumulated_sms">
    <query>|`ams_cumulated_sms`</query>
    <earliest>$earliest$</earliest>
    <latest>$latest$</latest>
  </search>
  <fieldset autoRun="true" submitButton="false"></fieldset>
  <row>
    <panel>
      <title>Absences Report [AMS-US-46]</title>
      <table>
        <search base="base_search_view_table"></search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="Natco">
          <colorPalette type="map">{"FR":#FFFFFF,"UK":#3863A0,"SP":#F7BC38,"GR":#555555}</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>AMS Absences KPIs</title>
      <input type="dropdown" searchWhenChanged="true" token="sort_by">
        <label>Sort by</label>
        <choice value="1y">Year</choice>
        <choice value="1mon">Month</choice>
        <choice value="1w">week</choice>
        <choice value="1d">Day</choice>
        <default>1d</default>
      </input>
      <input type="dropdown" searchWhenChanged="true">
        <label>Select Time Period:</label>
        <choice value="Last_7_days">Last 7 days</choice>
        <choice value="Last_month">Previous month</choice>
        <choice value="Last_6_months">Last 6 months</choice>
        <choice value="Last_year">Previous year</choice>
        <choice value="Last_2_years">Last 2 years</choice>
        <choice value="Last_3_years">Last 3 years</choice>
        <choice value="Last_5_years">Last 5 years</choice>
        <change>
          <condition value="Last_7_days">
            <set token="earliest">-7d@h</set>
            <set token="latest">now</set>
          </condition>
          <condition value="Last_month">
            <set token="earliest">-1mon@mon</set>
            <set token="latest">now</set>
          </condition>
          <condition value="Last_6_months">
            <set token="earliest">-6mon@mon</set>
            <set token="latest">now</set>
          </condition>
          <condition value="Last_year">
            <set token="earliest">-1y@y</set>
            <set token="latest">now</set>
          </condition>
          <condition value="Last_2_years">
            <set token="earliest">-2y@y</set>
            <set token="latest">now</set>
          </condition>
          <condition value="Last_3_years">
            <set token="earliest">-3y@y</set>
            <set token="latest">now</set>
          </condition>
          <condition value="Last_5_years">
            <set token="earliest">-5y@y</set>
            <set token="latest">now</set>
          </condition>
        </change>
        <default>Last_7_days</default>
        <initialValue>Last_7_days</initialValue>
      </input>
      <input type="dropdown" searchWhenChanged="true" token="select_natco">
        <label>Select a NatCo</label>
        <choice value="FR">France</choice>
        <choice value="SP">Spain</choice>
        <choice value="UK">UK</choice>
        <choice value="GE">Germany</choice>
        <default>FR</default>
        <initialValue>FR</initialValue>
        <change>
          <condition value="FR">
            <set token="new_search_fr">true</set>
            <unset token="new_search_all"></unset>
          </condition>
          <condition value="SP">
            <set token="new_search_all">true</set>
            <unset token="new_search_fr"></unset>
          </condition>
          <condition value="UK">
            <set token="new_search_all">true</set>
            <unset token="new_search_fr"></unset>
          </condition>
          <condition value="GE">
            <set token="new_search_all">true</set>
            <unset token="new_search_fr"></unset>
          </condition>
        </change>
      </input>
      <chart>
        <title>Absence KPI for $select_natco$ [AMS-US-40]</title>
        <search base="base_search">
          <query>|  fillnull value=0 DateInitialReturnToWorkExtended | fillnull value=NULL DateInitialReturnToWork ClosedDate DateEndTime DateStartTime| search DateEndTime=NULL | timechart count(_time) AS SickLeave_inLive span=$sort_by$ | join _time [search index="ai-x620-ams" sourcetype=x620:ams:dbAbsences  source="x620-airbuscontract$select_natco$-inputUS40" |timechart count(_time) AS "SickLeave" span=$sort_by$]</query>
        </search>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.chart">line</option>
        <option name="charting.drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
      <table>
        <search base="base_search">
          <query>|  fillnull value=0 DateInitialReturnToWorkExtended | fillnull value=NULL DateInitialReturnToWork ClosedDate DateEndTime DateStartTime| search DateEndTime=NULL | timechart count(_time) AS SickLeave_inLive span=$sort_by$ | join _time [search index="ai-x620-ams" sourcetype=x620:ams:dbAbsences source="x620-airbuscontract$select_natco$-inputUS40" |timechart count(_time) AS "SickLeave" span=$sort_by$]</query>
        </search>
        <option name="count">5</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Cumulated Absences KPI for $select_natco$ [AMS-US-40]</title>
      <chart>
        <search base="base_search">
          <query>|  fillnull value=0 DateInitialReturnToWorkExtended | fillnull value=NULL DateInitialReturnToWork ClosedDate DateEndTime DateStartTime| search DateEndTime=NULL | timechart count(_time) AS SickLeave_inLive_cumulated span=$sort_by$ | accum SickLeave_inLive_cumulated | join _time [search index="ai-x620-ams" sourcetype=x620:ams:dbAbsences source="x620-airbuscontract$select_natco$-inputUS40" |timechart count(_time) AS "SickLeave_cumulated" span=$sort_by$ | accum SickLeave_cumulated]</query>
        </search>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.chart">line</option>
        <option name="charting.drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
      <table>
        <search base="base_search">
          <query>|  fillnull value=0 DateInitialReturnToWorkExtended | fillnull value=NULL DateInitialReturnToWork ClosedDate DateEndTime DateStartTime| search DateEndTime=NULL | timechart count(_time) AS SickLeave_inLive_cumulated span=$sort_by$ | accum SickLeave_inLive_cumulated | join _time [search index="ai-x620-ams" sourcetype=x620:ams:dbAbsences source="x620-airbuscontract$select_natco$-inputUS40" |timechart count(_time) AS "SickLeave_cumulated" span=$sort_by$ | accum SickLeave_cumulated]</query>
        </search>
        <option name="count">5</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row depends="$new_search_all$">
    <panel>
      <title>Number of SMS for $select_natco$ [AMS-US-50]</title>
      <chart>
        <search>
          <query>|`ams_number_of_sms($select_natco$,$sort_by$)`</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.chart">column</option>
        <option name="charting.drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
  <row depends="$new_search_fr$">
    <panel>
      <title>Number of SMS for $select_natco$ [AMS-US-50]</title>
      <chart>
        <search>
          <query>|`ams_number_of_sms_fr($select_natco$, $form.sort_by$)`</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.chart">column</option>
        <option name="charting.drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Cumulated Number of SMS [AMS-US-51]</title>
      <chart>
        <search base="base_search_cumulated_sms">
          <query>|  fillnull value=NULL DateSent | search DateSent!=Null | timechart span=$sort_by$ count(DateSent) as TotalSMS by year | eval threshold = 40000</query>
        </search>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.axisY2.enabled">1</option>
        <option name="charting.axisY2.scale">log</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.chart.overlayFields">threshold</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.legend.placement">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
</form>